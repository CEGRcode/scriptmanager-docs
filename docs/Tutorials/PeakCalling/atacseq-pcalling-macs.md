---
id: atacseq-pcalling-macs
title: "ATAC-seq Peak Calling (MACS)"
sidebar_label: "ATAC-seq Peak Calling (MACS)"
sidebar_position: 3
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import Link from '@docusaurus/Link';

_Performing ATAC-seq peak calling with MACS2_ 

**Goal:** This tutorial provides a guide to peak calling using MACS2 and data generated by the [Stanford Encode Project][encode-project]. 

## Download Data

You need one set of genomic coordinate regions to investigate (BED) and one file of sequencing data alignments (BAM) to complete this exercise. [Read more about the BED/BAM file formats here.][file-formats]


### BED File
This is the set of transcription start site (TSS) annotations for the GRCh38 genome build that has been subsampled down to 2000 sites for quick tutorial purposes. A more formal analysis may use a more complete set of annotations (many more sites).

<Link
  className="button button--secondary"
  target="\_blank"
  href="/sample_data/atac-seq-tutorial/UCSC_GRCh38_knownGene_GENCODEV3_TSS_2000bp_SUBSAMPLE-2000-Sites.bed" >
  Download sample BED file
</Link>

<br />
<br />

:::caution
If your BED file downloads with a `.txt` extension, make sure to change the filename to a `.bed` extension. For this tutorial, the BED file is named `UCSC_GRCh38_knownGene_GENCODEV3_TSS_2000bp_SUBSAMPLE-2000-Sites.bed`.
:::

### BAM File
This is the set of read alignments from the [ENCODE Project][encode-project] (`ENCFF534DCE.bam`). 

<Link
  className="button button--secondary"
  href="https://www.encodeproject.org/files/ENCFF128WZG/@@download/ENCFF534DCE.bam">
  Download sample BAM file
</Link>

<br />
<br />

:::caution
The BAM file is ~6.5GB large so make sure you have enough space on your machine before downloading.
:::

## Peak Calling ATAC-seq with MACS2 

### 1. Install MACS2

#### 1.1 Install using pip 
# EXPLAIN WHAT THIS ISE


```bash
python3 -m venv macs2_env
source macs2_env/bin/activate
pip install --upgrade pip wheel
pip install numpy
pip install MACS2
```

#### 1.2 Install using conda
# EXPLAIN WHAT THIS IS

```bash
conda create -n macs2_env python=3.8
conda activate macs2_env
conda install -c bioconda macs2
```

### 2. Generate BAI index file
A BAI index file is required for each BAM file of interest (i.e., the tag occupancy data you want to plot). This file allows for rapid access of the sorted and aligned sequence reads (BAM file).

:::tip

SAM/BAM standard is to keep BAI file in same directory as BAM file with the ScriptManager-generated filename.

```bash
samtools index ENCFF534DCE.bam 
```

### 3. Run MACS2 for ATAC-seq
ATAC-seq is slightly different from ChIP-seq because fragments are shifted by Tn5 transposase insertions and you usually call peaks with paired-end BAM.
 
 ```bash
 macs2 callpeak -t ENCFF534DCE.bam \
  -f BAMPE \
  -g hs \
  -n sample_ATAC \
  --outdir macs2_output \
  --shift -100 --extsize 200 \
  -q 0.01
  ```

  Key flags explained:
  - -f BAMPE: Paired-end BAM input
  - -g hs: Human genome
  - --shift -100 --extsize 200: Adjusts for Tn5 integration offset
  - -q 0.01: False Discovery Rate Threshold

  The output files should be the follwoing: 
  - **sample_ATAC_peaks.narrowPeak**: Peak regions (main file to use downstream)
  - **sample_ATAC_peaks.xls**: Detailed peak statistics
  - **sample_ATAC_summits.bed**: Summit positions
  - **sample_ATAC_model.r**: R script for fragment size distribution









